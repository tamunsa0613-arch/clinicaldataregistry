# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.1.1] - 2026-02-17

### Fixed
- **経過グラフ分離モード**: 複数検査項目選択時に全項目が1つのグラフに重なっていた問題を修正
  - 分離モード（separate）で項目ごとに独立したグラフを表示するように変更
  - 各グラフに項目名・単位をタイトル表示、Y軸に単位を表示
  - X軸の「days」ラベルは最下部のグラフにのみ表示
- **相関ヒートマップPNGダウンロード**: SVG凡例内の `*p<0.05` 等の `<` がXML特殊文字として解釈され、PNG変換時に `img.onload` が発火しない問題を修正
  - `<` を `&lt;` にエスケープして厳密なXMLパースに対応

### Added
- **ラベル多言語翻訳の完全対応**: `labelTranslations` に不足していた32項目を追加
  - 臨床イベント（12項目追加）: 食欲不振、体重減少、低/高ナトリウム血症、SIADH、尿崩症、高/低血糖、甲状腺機能低下/亢進、副腎不全
  - 治療薬カテゴリ（20項目追加）: 抗菌薬サブカテゴリ（ペニシリン系/セフェム系/カルバペネム系/その他）、抗真菌薬、昇圧薬・強心薬、鎮静薬・鎮痛薬、筋弛緩薬、血液製剤、抗凝固薬、透析関連、利尿薬、腎性貧血治療薬、ネフローゼ治療薬、降圧薬、ホルモン補充療法、糖尿病治療薬、電解質補正、ミトコンドリア治療、栄養・微量元素補充
  - カバー率: 治療薬 28/28 (100%)、臨床イベント 33/33 (100%)

---

## [1.4.0] - 2026-02-04

### Added
- **マルチテナント（組織分離）機能**
  - OrganizationContext: 組織管理のコンテキスト
  - 組織セレクター: 複数組織所属時にヘッダーで切り替え可能
  - システム管理パネル: 組織作成・メンバー一括追加
  - 組織ベースのFirestoreセキュリティルール
- **メールアドレス一括登録機能**
  - 管理パネルでコピー＆ペーストによる一括登録
  - 改行・カンマ・セミコロン区切りに対応

### Changed
- Firestoreセキュリティルールを組織ベースに拡張（後方互換性維持）

### Technical Notes
- 新しいFirestoreコレクション: `organizations`, `organizationMembers`
- システム管理者は `config/systemAdmin` ドキュメントで設定
- 既存の `users/{uid}/patients` パスは後方互換性のため維持

---

## [1.3.0] - 2026-02-02

### Added
- **経過グラフ作成機能の改善**
  - 二軸表示: 異なるスケールの検査値を左右の軸で表示
  - 分離表示モードでの二軸表示対応
  - 検査項目クリックで軸を切り替え
- **操作ガイドの更新**
  - アプリ内に4ステップガイドを追加
  - HTMLマニュアル（manual.html）を更新

### Changed
- 「経時データ分析」を「経過グラフ作成」に名称変更
- 臨床経過セクションを入力専用に変更（出力は経過グラフ作成へ）

---

## [1.2.0] - Previous

### Added
- 臨床経過タイムライン機能
- 治療薬管理機能
- Excelエクスポート機能
- 群間統計比較機能

---

## [1.1.0] - Previous

### Added
- OCR機能（Cloud Vision API）
- 検査データ一括インポート
- 患者一括登録機能

---

## [1.0.0] - Initial Release

### Added
- Firebase Authentication によるユーザー認証
- 患者データ管理
- 検査データ入力・可視化
- CSVエクスポート機能
