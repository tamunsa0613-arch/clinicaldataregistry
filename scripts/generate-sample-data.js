const XLSX = require('xlsx');
const path = require('path');

// ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å…ˆ
const outputDir = path.join(__dirname, '..', 'sample-data');
const fs = require('fs');

if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

// ============================================================
// 1. æ–°ç”Ÿå…é«˜ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¡€ç—‡ï¼ˆCongenital Hyperinsulinismï¼‰
// ============================================================
function generateHyperinsulinismData() {
  const dates = ['2025-01-01', '2025-01-02', '2025-01-03', '2025-01-04', '2025-01-05', '2025-01-07', '2025-01-10', '2025-01-14'];

  const labData = [
    ['æ¤œæŸ»é …ç›®', 'å˜ä½', ...dates],
    ['è¡€ç³–', 'mg/dL', 28, 32, 35, 42, 48, 55, 68, 75],
    ['ã‚¤ãƒ³ã‚¹ãƒªãƒ³', 'Î¼U/mL', 15.2, 14.8, 13.5, 12.1, 10.5, 8.2, 6.5, 5.8],
    ['C-ãƒšãƒ—ãƒãƒ‰', 'ng/mL', 2.8, 2.6, 2.4, 2.2, 2.0, 1.8, 1.5, 1.2],
    ['ã‚±ãƒˆãƒ³ä½“', 'Î¼mol/L', 50, 45, 40, 80, 120, 180, 250, 300],
    ['Na', 'mEq/L', 138, 139, 140, 139, 140, 141, 140, 141],
    ['K', 'mEq/L', 4.2, 4.1, 4.0, 3.9, 3.8, 4.0, 4.1, 4.2],
  ];

  const treatmentData = [
    ['é–‹å§‹æ—¥', 'çµ‚äº†æ—¥', 'ã‚«ãƒ†ã‚´ãƒª', 'è–¬å‰¤å', 'ç”¨é‡', 'å˜ä½'],
    ['2025-01-01', '2025-01-14', 'å†…åˆ†æ³Œ', 'ãƒ–ãƒ‰ã‚¦ç³–æŒç¶šç‚¹æ»´ï¼ˆGIRï¼‰', 12, 'mg/kg/min'],
    ['2025-01-03', '2025-01-14', 'å†…åˆ†æ³Œ', 'ã‚¸ã‚¢ã‚¾ã‚­ã‚·ãƒ‰', 10, 'mg/kg/æ—¥'],
    ['2025-01-03', '2025-01-14', 'åˆ©å°¿è–¬', 'ãƒ’ãƒ‰ãƒ­ã‚¯ãƒ­ãƒ­ãƒã‚¢ã‚¸ãƒ‰', 2, 'mg/kg/æ—¥'],
    ['2025-01-01', '2025-01-03', 'å†…åˆ†æ³Œ', 'ã‚°ãƒ«ã‚«ã‚´ãƒ³æŒç¶šç‚¹æ»´', 5, 'Î¼g/kg/æ™‚'],
  ];

  const eventData = [
    ['æ—¥ä»˜', 'ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—', 'è©³ç´°'],
    ['2025-01-01', 'å…¥é™¢', 'ç”Ÿå¾Œ6æ™‚é–“ã€å“ºä¹³ä¸è‰¯ãƒ»ã‘ã„ã‚Œã‚“ã§ç™ºè¦‹ã€‚è¡€ç³–28mg/dL'],
    ['2025-01-01', 'æ¤œæŸ»', 'è¡€ç³–ä½å€¤ã«ã‚‚é–¢ã‚ã‚‰ãšã‚¤ãƒ³ã‚¹ãƒªãƒ³é«˜å€¤ - é«˜ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¡€ç—‡ç–‘ã„'],
    ['2025-01-02', 'æ¤œæŸ»', 'GIR 12mg/kg/minã§ã‚‚ä½è¡€ç³–æŒç¶šã€å…ˆå¤©æ€§é«˜ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¡€ç—‡ã¨è¨ºæ–­'],
    ['2025-01-03', 'æ²»ç™‚é–‹å§‹', 'ã‚¸ã‚¢ã‚¾ã‚­ã‚·ãƒ‰é–‹å§‹ï¼ˆ10mg/kg/æ—¥ï¼‰'],
    ['2025-01-07', 'æ”¹å–„', 'GIRæ¸›é‡é–‹å§‹å¯èƒ½ã€çµŒå£å“ºä¹³å¢—é‡'],
    ['2025-01-14', 'é€€é™¢', 'ã‚¸ã‚¢ã‚¾ã‚­ã‚·ãƒ‰å†…æœç¶™ç¶šã§é€€é™¢ã€‚è¡€ç³–å®‰å®š'],
  ];

  return { labData, treatmentData, eventData, name: 'æ–°ç”Ÿå…é«˜ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¡€ç—‡', patientId: 'HI-001', group: 'å†…åˆ†æ³Œ', onsetDate: '2025-01-01' };
}

// ============================================================
// 2. DKAï¼ˆç³–å°¿ç—…æ€§ã‚±ãƒˆã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹ï¼‰æ€¥æ€§æœŸ
// ============================================================
function generateDKAData() {
  const dates = ['2025-02-01', '2025-02-01', '2025-02-01', '2025-02-01', '2025-02-01', '2025-02-02', '2025-02-02', '2025-02-03'];
  const times = ['00:00', '04:00', '08:00', '12:00', '18:00', '00:00', '12:00', '00:00'];
  const dateLabels = dates.map((d, i) => `${d}\n${times[i]}`);

  const labData = [
    ['æ¤œæŸ»é …ç›®', 'å˜ä½', ...dateLabels],
    ['è¡€ç³–', 'mg/dL', 580, 420, 320, 250, 195, 165, 145, 125],
    ['pH', '', 7.05, 7.12, 7.22, 7.28, 7.32, 7.36, 7.38, 7.40],
    ['HCO3', 'mEq/L', 5.2, 7.5, 10.2, 13.5, 16.8, 19.5, 21.2, 23.0],
    ['ã‚±ãƒˆãƒ³ä½“', 'mmol/L', 6.8, 5.5, 4.2, 3.0, 1.8, 0.8, 0.3, 0.1],
    ['Na', 'mEq/L', 128, 132, 135, 137, 138, 140, 141, 142],
    ['K', 'mEq/L', 5.8, 5.2, 4.5, 4.2, 4.0, 3.9, 4.0, 4.1],
    ['BUN', 'mg/dL', 32, 28, 24, 20, 18, 15, 14, 12],
    ['Cr', 'mg/dL', 1.2, 1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.5],
  ];

  const treatmentData = [
    ['é–‹å§‹æ—¥', 'çµ‚äº†æ—¥', 'ã‚«ãƒ†ã‚´ãƒª', 'è–¬å‰¤å', 'ç”¨é‡', 'å˜ä½'],
    ['2025-02-01', '2025-02-01', 'ICU', 'ç”Ÿç†é£Ÿå¡©æ°´ãƒœãƒ¼ãƒ©ã‚¹', 20, 'mL/kg'],
    ['2025-02-01', '2025-02-02', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆé€ŸåŠ¹å‹ï¼‰æŒç¶šé™æ³¨', 0.1, 'å˜ä½/kg/æ™‚'],
    ['2025-02-01', '2025-02-02', 'ICU', 'ç¶­æŒè¼¸æ¶²', 100, 'mL/kg/æ—¥'],
    ['2025-02-01', '2025-02-01', 'é›»è§£è³ªè£œæ­£', 'å¡©åŒ–ã‚«ãƒªã‚¦ãƒ ', 40, 'mEq/L'],
    ['2025-02-02', '2025-02-03', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆé€ŸåŠ¹å‹ï¼‰çš®ä¸‹æ³¨', 1, 'å˜ä½/kg/æ—¥'],
  ];

  const eventData = [
    ['æ—¥ä»˜', 'ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—', 'è©³ç´°'],
    ['2025-02-01', 'å…¥é™¢', '10æ­³ç”·å…ã€å£æ¸‡ãƒ»å¤šå°¿ãƒ»å˜”åãƒ»æ„è­˜éšœå®³ã§ERæ¬é€ã€‚è¡€ç³–580ã€pH7.05'],
    ['2025-02-01', 'è¨ºæ–­', '1å‹ç³–å°¿ç—…ã€é‡ç—‡DKAï¼ˆpH<7.1ï¼‰ã¨è¨ºæ–­ã€‚PICUå…¥å®¤'],
    ['2025-02-01', 'æ²»ç™‚é–‹å§‹', 'ç”Ÿé£Ÿãƒœãƒ¼ãƒ©ã‚¹å¾Œã€ã‚¤ãƒ³ã‚¹ãƒªãƒ³æŒç¶šé™æ³¨é–‹å§‹ï¼ˆ0.1U/kg/hrï¼‰'],
    ['2025-02-01', 'æ”¹å–„', 'ã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹æ”¹å–„å‚¾å‘ã€æ„è­˜æ¸…æ˜ã«'],
    ['2025-02-02', 'æ²»ç™‚å¤‰æ›´', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³çš®ä¸‹æ³¨å°„ã¸ç§»è¡Œã€çµŒå£æ‘‚å–é–‹å§‹'],
    ['2025-02-03', 'å›å¾©', 'DKAé›¢è„±ã€ä¸€èˆ¬ç—…æ£Ÿè»¢æ£Ÿã€‚ç³–å°¿ç—…æ•™è‚²é–‹å§‹'],
  ];

  return { labData, treatmentData, eventData, name: 'DKAæ€¥æ€§æœŸ', patientId: 'DKA-001', group: 'å†…åˆ†æ³Œ', onsetDate: '2025-02-01' };
}

// ============================================================
// 3. 1å‹ç³–å°¿ç—… æ…¢æ€§æœŸç®¡ç†
// ============================================================
function generateT1DMChronicData() {
  const dates = ['2024-06-01', '2024-07-15', '2024-09-01', '2024-10-15', '2024-12-01', '2025-01-15', '2025-03-01'];

  const labData = [
    ['æ¤œæŸ»é …ç›®', 'å˜ä½', ...dates],
    ['HbA1c', '%', 12.5, 10.8, 9.2, 8.5, 7.8, 7.4, 7.0],
    ['ç©ºè…¹æ™‚è¡€ç³–', 'mg/dL', 280, 220, 180, 150, 130, 120, 110],
    ['é£Ÿå¾Œ2hè¡€ç³–', 'mg/dL', 420, 320, 260, 220, 190, 175, 160],
    ['C-ãƒšãƒ—ãƒãƒ‰', 'ng/mL', 0.30, 0.20, 0.15, 0.10, 0.08, 0.05, 0.03],
    ['å°¿ä¸­ã‚¢ãƒ«ãƒ–ãƒŸãƒ³', 'mg/gCr', 25, 20, 18, 15, 12, 10, 8],
    ['TSH', 'Î¼U/mL', 2.5, 2.3, 2.4, 2.2, 2.5, 2.3, 2.4],
  ];

  const treatmentData = [
    ['é–‹å§‹æ—¥', 'çµ‚äº†æ—¥', 'ã‚«ãƒ†ã‚´ãƒª', 'è–¬å‰¤å', 'ç”¨é‡', 'å˜ä½'],
    ['2024-06-01', '2024-07-15', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆæŒåŠ¹å‹ï¼‰', 0.3, 'å˜ä½/kg/æ—¥'],
    ['2024-06-01', '2024-07-15', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆé€ŸåŠ¹å‹ï¼‰', 0.4, 'å˜ä½/kg/æ—¥'],
    ['2024-07-15', '2024-10-15', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆæŒåŠ¹å‹ï¼‰', 0.35, 'å˜ä½/kg/æ—¥'],
    ['2024-07-15', '2024-10-15', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆé€ŸåŠ¹å‹ï¼‰', 0.45, 'å˜ä½/kg/æ—¥'],
    ['2024-10-15', '2025-03-01', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆæŒåŠ¹å‹ï¼‰', 0.4, 'å˜ä½/kg/æ—¥'],
    ['2024-10-15', '2025-03-01', 'ç³–å°¿ç—…æ²»ç™‚è–¬', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼ˆé€ŸåŠ¹å‹ï¼‰', 0.5, 'å˜ä½/kg/æ—¥'],
  ];

  const eventData = [
    ['æ—¥ä»˜', 'ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—', 'è©³ç´°'],
    ['2024-06-01', 'è¨ºæ–­', '8æ­³å¥³å…ã€DKAã§ç™ºç—‡ã—ãŸ1å‹ç³–å°¿ç—…ã€‚æŠ—GADæŠ—ä½“é™½æ€§'],
    ['2024-06-15', 'é€€é™¢', 'ã‚¤ãƒ³ã‚¹ãƒªãƒ³è‡ªå·±æ³¨å°„ãƒ»è¡€ç³–è‡ªå·±æ¸¬å®šç¿’å¾—ã—é€€é™¢'],
    ['2024-07-15', 'å¤–æ¥', 'HbA1c 10.8%ã€ã‚¤ãƒ³ã‚¹ãƒªãƒ³é‡èª¿æ•´'],
    ['2024-09-01', 'å¤–æ¥', 'HbA1c 9.2%ã€å­¦æ ¡ç”Ÿæ´»é †èª¿ã€‚ã‚«ãƒ¼ãƒœã‚«ã‚¦ãƒ³ãƒˆå°å…¥'],
    ['2024-10-15', 'å¤–æ¥', 'HbA1c 8.5%ã€ä½è¡€ç³–ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ¸›å°‘'],
    ['2024-12-01', 'å¤–æ¥', 'HbA1c 7.8%ã€è‰¯å¥½ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«'],
    ['2025-01-15', 'å¤–æ¥', 'HbA1c 7.4%ã€ç›®æ¨™ã«è¿‘ã¥ã'],
    ['2025-03-01', 'å¤–æ¥', 'HbA1c 7.0%é”æˆï¼å­¦æ ¡ãƒ»é‹å‹•å•é¡Œãªã—'],
  ];

  return { labData, treatmentData, eventData, name: '1å‹ç³–å°¿ç—…æ…¢æ€§æœŸ', patientId: 'T1DM-001', group: 'å†…åˆ†æ³Œ', onsetDate: '2024-06-01' };
}

// ============================================================
// Excelãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
// ============================================================
function createExcelFile(data, filename) {
  const wb = XLSX.utils.book_new();

  // æ¤œæŸ»ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ
  const wsLab = XLSX.utils.aoa_to_sheet(data.labData);
  XLSX.utils.book_append_sheet(wb, wsLab, 'æ¤œæŸ»ãƒ‡ãƒ¼ã‚¿');

  // æ²»ç™‚ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ
  const wsTreatment = XLSX.utils.aoa_to_sheet(data.treatmentData);
  XLSX.utils.book_append_sheet(wb, wsTreatment, 'æ²»ç™‚ãƒ‡ãƒ¼ã‚¿');

  // è‡¨åºŠã‚¤ãƒ™ãƒ³ãƒˆã‚·ãƒ¼ãƒˆ
  const wsEvent = XLSX.utils.aoa_to_sheet(data.eventData);
  XLSX.utils.book_append_sheet(wb, wsEvent, 'è‡¨åºŠã‚¤ãƒ™ãƒ³ãƒˆ');

  // æ‚£è€…æƒ…å ±ã‚·ãƒ¼ãƒˆï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½å½¢å¼ï¼‰
  const patientInfo = [
    ['é …ç›®', 'å€¤'],
    ['æ‚£è€…ID', data.patientId],
    ['ç–¾æ‚£å', data.name],
    ['ä½œæˆæ—¥', new Date().toISOString().split('T')[0]],
    ['å‚™è€ƒ', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ - ãƒ†ã‚¹ãƒˆç”¨'],
  ];
  const wsPatient = XLSX.utils.aoa_to_sheet(patientInfo);
  XLSX.utils.book_append_sheet(wb, wsPatient, 'æ‚£è€…æƒ…å ±');

  const filePath = path.join(outputDir, filename);
  XLSX.writeFile(wb, filePath);
  console.log(`Created: ${filePath}`);
}

// æ‚£è€…ä¸€æ‹¬ç™»éŒ²ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
function createPatientListFile(patients) {
  const wb = XLSX.utils.book_new();

  // æ‚£è€…ãƒªã‚¹ãƒˆã‚·ãƒ¼ãƒˆï¼ˆã‚¢ãƒ—ãƒªã®æœŸå¾…ã™ã‚‹å½¢å¼ï¼‰
  const patientData = [
    ['PatientID', 'Diagnosis', 'Group', 'OnsetDate', 'Memo'],
    ...patients.map(p => [p.patientId, p.name, p.group, p.onsetDate, 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿'])
  ];
  const wsPatients = XLSX.utils.aoa_to_sheet(patientData);
  XLSX.utils.book_append_sheet(wb, wsPatients, 'æ‚£è€…ãƒªã‚¹ãƒˆ');

  // èª¬æ˜ã‚·ãƒ¼ãƒˆ
  const instructions = [
    ['åˆ—å', 'èª¬æ˜', 'å¿…é ˆ'],
    ['PatientID', 'æ‚£è€…IDï¼ˆä¾‹: HI-001ï¼‰', 'â—‹'],
    ['Diagnosis', 'è¨ºæ–­å', 'â—‹'],
    ['Group', 'ç¾¤ï¼ˆæ¯”è¼ƒåˆ†æç”¨ï¼‰', ''],
    ['OnsetDate', 'ç™ºç—‡æ—¥ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰', ''],
    ['Memo', 'ãƒ¡ãƒ¢ãƒ»å‚™è€ƒ', ''],
    ['', '', ''],
    ['ä½¿ç”¨æ–¹æ³•', '', ''],
    ['1. ã‚¢ãƒ—ãƒªã®ã€Œæ‚£è€…ä¸€æ‹¬ç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯', '', ''],
    ['2. ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰', '', ''],
    ['3. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèªã—ã¦ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯', '', ''],
  ];
  const wsInst = XLSX.utils.aoa_to_sheet(instructions);
  XLSX.utils.book_append_sheet(wb, wsInst, 'èª¬æ˜');

  const filePath = path.join(outputDir, 'sample_æ‚£è€…ä¸€æ‹¬ç™»éŒ².xlsx');
  XLSX.writeFile(wb, filePath);
  console.log(`Created: ${filePath}`);
}

// ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
console.log('Generating sample data files...\n');

const hyperinsulinism = generateHyperinsulinismData();
createExcelFile(hyperinsulinism, 'sample_æ–°ç”Ÿå…é«˜ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¡€ç—‡.xlsx');

const dka = generateDKAData();
createExcelFile(dka, 'sample_DKAæ€¥æ€§æœŸ.xlsx');

const t1dm = generateT1DMChronicData();
createExcelFile(t1dm, 'sample_1å‹ç³–å°¿ç—…æ…¢æ€§æœŸ.xlsx');

// æ‚£è€…ä¸€æ‹¬ç™»éŒ²ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
createPatientListFile([hyperinsulinism, dka, t1dm]);

console.log('\nAll sample data files created in:', outputDir);
console.log('\n=== ä½¿ç”¨æ‰‹é † ===');
console.log('');
console.log('ã€Step 1: æ‚£è€…ä¸€æ‹¬ç™»éŒ²ã€‘');
console.log('1. ã‚¢ãƒ—ãƒªã§ã€ŒğŸ“¥ æ‚£è€…ä¸€æ‹¬ç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯');
console.log('2. sample_æ‚£è€…ä¸€æ‹¬ç™»éŒ².xlsx ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰');
console.log('3. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèªã—ã¦ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã€');
console.log('');
console.log('ã€Step 2: æ¤œæŸ»ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã€‘');
console.log('1. ã€ŒğŸ“Š ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯');
console.log('2. å„ç–¾æ‚£ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰');
console.log('3. å¯¾è±¡æ‚£è€…ã‚’é¸æŠã—ã¦ã€Œç™»éŒ²ã€');
